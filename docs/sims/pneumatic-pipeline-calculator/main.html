<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pneumatic Conveying Pipeline Design Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .left-panel {
            flex: 0 0 320px;
            padding: 20px;
            background: #fafafa;
            border-right: 1px solid #eee;
            overflow-y: auto;
            max-height: 800px;
        }

        .right-panel {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        input[type="range"] {
            flex: 1;
        }

        .value-display {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            min-width: 50px;
            text-align: right;
        }

        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background: white;
            cursor: pointer;
            color: #333;
        }

        select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background: white;
            border: 1px solid #eee;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .results-panel {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .result-value {
            font-size: 14px;
            font-weight: 700;
            color: #333;
        }

        .result-item.green .result-value {
            color: #4caf50;
        }

        .result-item.yellow .result-value {
            color: #ff9800;
        }

        .result-item.red .result-value {
            color: #f44336;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-badge.green {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .status-badge.yellow {
            background: #ffe0b2;
            color: #e65100;
        }

        .status-badge.red {
            background: #ffcdd2;
            color: #c62828;
        }

        .calc-step {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            margin-top: 15px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .calc-step-label {
            color: #666;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .calc-step-value {
            color: #2c3e50;
            font-size: 13px;
            font-weight: 600;
        }

        @media (max-width: 800px) {
            .container {
                flex-direction: column;
            }

            .left-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid #eee;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <h2>Input Parameters</h2>

            <div class="form-group">
                <label>Horizontal Pipe Length (ft)</label>
                <div class="input-group">
                    <input type="range" id="horizontalLength" min="50" max="500" value="200" step="10">
                    <div class="value-display" id="horizontalLengthValue">200</div>
                </div>
            </div>

            <div class="form-group">
                <label>Vertical Rise (ft)</label>
                <div class="input-group">
                    <input type="range" id="verticalRise" min="0" max="100" value="30" step="5">
                    <div class="value-display" id="verticalRiseValue">30</div>
                </div>
            </div>

            <div class="form-group">
                <label>Number of Bends</label>
                <select id="numBends">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6" selected>6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="12">12</option>
                    <option value="15">15</option>
                </select>
            </div>

            <div class="form-group">
                <label>Bend Type</label>
                <select id="bendType">
                    <option value="50" selected>Short radius (50 ft eq.)</option>
                    <option value="30">Long radius (30 ft eq.)</option>
                    <option value="20">Blind tee (20 ft eq.)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Pipe Diameter</label>
                <select id="pipeDiameter">
                    <option value="3">3"</option>
                    <option value="4" selected>4"</option>
                    <option value="5">5"</option>
                    <option value="6">6"</option>
                    <option value="8">8"</option>
                </select>
            </div>

            <div class="form-group">
                <label>Material Type</label>
                <select id="materialType">
                    <option value="pellets">Plastic Pellets (min 60 ft/s, 45 lb/ft³)</option>
                    <option value="flour">Flour (min 55 ft/s, 35 lb/ft³)</option>
                    <option value="cement">Cement (min 70 ft/s, 95 lb/ft³)</option>
                    <option value="sugar">Sugar (min 50 ft/s, 50 lb/ft³)</option>
                    <option value="sand">Sand (min 75 ft/s, 100 lb/ft³)</option>
                </select>
            </div>
        </div>

        <div class="right-panel">
            <div class="canvas-container" id="p5-container"></div>

            <div class="results-panel">
                <h2 style="margin-bottom: 15px;">Calculation Results</h2>

                <div class="result-item">
                    <span class="result-label">Equivalent Length (L_eq)</span>
                    <span class="result-value" id="equivalentLength">—</span>
                </div>

                <div class="calc-step">
                    <div class="calc-step-label">Calculation</div>
                    <div class="calc-step-value" id="calcFormula">L_eq = L_h + (2 × L_v) + (n × L_bend)</div>
                </div>

                <div class="result-item" id="pressureDropResult">
                    <span class="result-label">Estimated Pressure Drop</span>
                    <span class="result-value">— psi</span>
                </div>

                <div class="result-item" id="velocityStatus">
                    <span class="result-label">Air Velocity Status</span>
                    <span class="result-value">—</span>
                </div>

                <div class="result-item" id="airMoverResult">
                    <span class="result-label">Recommended Air Mover</span>
                    <span class="result-value">—</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Material data
        const materialData = {
            pellets: { minVelocity: 60, density: 45, name: 'Plastic Pellets' },
            flour: { minVelocity: 55, density: 35, name: 'Flour' },
            cement: { minVelocity: 70, density: 95, name: 'Cement' },
            sugar: { minVelocity: 50, density: 50, name: 'Sugar' },
            sand: { minVelocity: 75, density: 100, name: 'Sand' }
        };

        // Pipe cross-sectional areas (in sq ft)
        const pipeDiameters = {
            3: 0.0491,
            4: 0.0873,
            5: 0.1364,
            6: 0.1963,
            8: 0.3491
        };

        // Input elements
        const horizontalInput = document.getElementById('horizontalLength');
        const verticalInput = document.getElementById('verticalRise');
        const numBendsInput = document.getElementById('numBends');
        const bendTypeInput = document.getElementById('bendType');
        const pipeDiameterInput = document.getElementById('pipeDiameter');
        const materialInput = document.getElementById('materialType');

        // Value displays
        const horizontalValue = document.getElementById('horizontalLengthValue');
        const verticalValue = document.getElementById('verticalRiseValue');

        // Update displays and calculations when inputs change
        horizontalInput.addEventListener('input', () => {
            horizontalValue.textContent = horizontalInput.value;
            updateCalculations();
        });

        verticalInput.addEventListener('input', () => {
            verticalValue.textContent = verticalInput.value;
            updateCalculations();
        });

        [numBendsInput, bendTypeInput, pipeDiameterInput, materialInput].forEach(el => {
            el.addEventListener('change', updateCalculations);
        });

        let sketchInstance = null;

        function updateCalculations() {
            const horizontal = parseFloat(horizontalInput.value);
            const vertical = parseFloat(verticalInput.value);
            const numBends = parseFloat(numBendsInput.value);
            const bendEquivalent = parseFloat(bendTypeInput.value);

            // Calculate equivalent length
            const verticalEquivalent = vertical * 2; // Vertical counts double
            const bendEquivalent_total = numBends * bendEquivalent;
            const equivalentLength = horizontal + verticalEquivalent + bendEquivalent_total;

            // Update formula display
            const formula = `${horizontal} + (2 × ${vertical}) + (${numBends} × ${bendEquivalent}) = ${equivalentLength.toFixed(1)} ft`;
            document.getElementById('calcFormula').textContent = formula;
            document.getElementById('equivalentLength').textContent = equivalentLength.toFixed(1) + ' ft';

            // Calculate pressure drop (simplified: 0.1 psi per 100 ft of equivalent length)
            const pressureDrop = (equivalentLength / 100) * 0.1;

            // Get material data
            const material = materialData[materialInput.value];
            const pipeDiameter = parseFloat(pipeDiameterInput.value);
            const pipeArea = pipeDiameters[pipeDiameter];

            // Calculate estimated CFM needed (using min velocity * area * 60 for conversion)
            const minCFM = (material.minVelocity * pipeArea * 60).toFixed(0);

            // Determine air mover recommendation
            let airMover = '';
            if (minCFM < 200) {
                airMover = 'Portable Compressor (3-5 hp)';
            } else if (minCFM < 500) {
                airMover = 'Rotary Screw Compressor (5-10 hp)';
            } else if (minCFM < 1000) {
                airMover = 'Industrial Rotary Screw (10-25 hp)';
            } else {
                airMover = 'Large Industrial System (25+ hp)';
            }

            // Determine status colors
            let status = 'green';
            if (pressureDrop > 8) status = 'red';
            else if (pressureDrop > 5) status = 'yellow';

            // Update results
            const pressureDropElement = document.getElementById('pressureDropResult');
            pressureDropElement.className = `result-item ${status}`;
            pressureDropElement.innerHTML = `
                <span class="result-label">Estimated Pressure Drop</span>
                <span class="result-value">${pressureDrop.toFixed(2)} psi</span>
            `;

            const velocityElement = document.getElementById('velocityStatus');
            velocityElement.className = `result-item ${status}`;
            velocityElement.innerHTML = `
                <span class="result-label">Air Velocity Status</span>
                <span class="result-value">${material.minVelocity} ft/s min <span class="status-badge ${status}">${status.toUpperCase()}</span></span>
            `;

            document.getElementById('airMoverResult').innerHTML = `
                <span class="result-label">Recommended Air Mover</span>
                <span class="result-value">${airMover}</span>
            `;

            // Trigger p5.js redraw
            if (sketchInstance && sketchInstance.redraw) {
                sketchInstance.redraw();
            }
        }

        // P5.js sketch
        const sketch = (p) => {
            p.setup = function() {
                const container = document.getElementById('p5-container');
                const w = container.offsetWidth - 40;
                const h = 350;
                p.createCanvas(w, h);
            };

            p.draw = function() {
                p.background(255);
                p.fill(240);
                p.stroke(200);
                p.strokeWeight(1);
                p.rect(10, 10, p.width - 20, p.height - 20);

                // Get current values
                const horizontal = parseFloat(horizontalInput.value);
                const vertical = parseFloat(verticalInput.value);
                const numBends = parseFloat(numBendsInput.value);

                // Normalize values for drawing
                const maxLength = 600;
                const scale = (p.width - 60) / maxLength;

                p.strokeWeight(3);
                p.stroke(33, 150, 243);
                p.fill(255);

                let x = 30;
                let y = p.height / 2;

                // Draw horizontal section
                const hDraw = (horizontal / maxLength) * (p.width - 60);
                p.line(x, y, x + hDraw, y);
                p.fill(33, 150, 243);
                p.text('Horizontal', x + hDraw / 2 - 30, y - 10);
                p.fill(255);

                x += hDraw;

                // Draw vertical section
                const vDraw = (vertical / 100) * (p.height - 80) * 0.8;
                p.line(x, y, x, y - vDraw);
                p.fill(33, 150, 243);
                p.text('Vertical', x + 10, y - vDraw / 2);
                p.fill(255);

                y -= vDraw;

                // Draw bends
                for (let i = 0; i < Math.min(numBends, 3); i++) {
                    p.stroke(244, 67, 54);
                    p.noFill();
                    p.arc(x + 15, y - 15 - (i * 25), 30, 30, 0, p.HALF_PI);
                    x += 30;
                }

                if (numBends > 3) {
                    p.fill(244, 67, 54);
                    p.textSize(12);
                    p.text(`+${numBends - 3} more bends`, x + 5, y - 5);
                }

                // Legend
                p.fill(100);
                p.textSize(11);
                p.text('Horizontal section', 30, p.height - 20);

                p.stroke(244, 67, 54);
                p.strokeWeight(2);
                p.line(180, p.height - 25, 210, p.height - 25);
                p.fill(100);
                p.text('Bends', 220, p.height - 20);
            };

            p.windowResized = function() {
                if (document.getElementById('p5-container')) {
                    const container = document.getElementById('p5-container');
                    const w = container.offsetWidth - 40;
                    p.resizeCanvas(w, 350);
                }
            };
        };

        // Initialize p5.js
        sketchInstance = new p5(sketch, 'p5-container');

        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>
