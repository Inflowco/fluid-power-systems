<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pneumatic Conveying Energy Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin-bottom: 40px;
        }

        .controls-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .controls-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-label {
            font-size: 13px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-value {
            color: #3498db;
            font-weight: 700;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ecf0f1;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .baseline-display {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            font-size: 14px;
        }

        .baseline-display span {
            font-weight: 700;
            color: #2980b9;
        }

        .results-section {
            margin-top: 30px;
        }

        .results-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: #34495e;
            color: white;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 13px;
        }

        tbody tr {
            transition: background-color 0.2s ease;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr.best-roi {
            background: #d4edda;
            font-weight: 600;
        }

        td.scenario {
            font-weight: 600;
            color: #2c3e50;
        }

        td.savings {
            color: #27ae60;
            font-weight: 600;
        }

        .roi-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pneumatic Conveying Energy Comparison</h1>
        <p class="subtitle">Compare energy consumption and costs across different conveying strategies</p>

        <div class="chart-container">
            <canvas id="energyChart"></canvas>
        </div>

        <div class="controls-section">
            <div class="controls-title">System Parameters</div>
            <div class="controls-grid">
                <div class="control-group">
                    <label class="control-label">
                        <span>Electricity Cost</span>
                        <span class="control-value">$<span id="costValue">0.10</span>/kWh</span>
                    </label>
                    <input type="range" id="costSlider" min="0.05" max="0.25" step="0.01" value="0.10">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>System Throughput</span>
                        <span class="control-value"><span id="throughputValue">10</span> tons/hr</span>
                    </label>
                    <input type="range" id="throughputSlider" min="1" max="100" step="1" value="10">
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <span>Operating Hours per Year</span>
                        <span class="control-value"><span id="hoursValue">6000</span> hrs/yr</span>
                    </label>
                    <input type="range" id="hoursSlider" min="1000" max="8760" step="100" value="6000">
                </div>
            </div>

            <div class="baseline-display">
                <strong>Baseline Energy Consumption:</strong> <span id="baselineKW">4.50</span> kW (based on <span id="throughputDisplay">10</span> tons/hr)
            </div>
        </div>

        <div class="results-section">
            <div class="results-title">Annual Energy & Cost Analysis</div>
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>Energy %</th>
                            <th>Annual kWh</th>
                            <th>Annual Cost</th>
                            <th>Annual Savings vs Baseline</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const scenarios = [
            { name: "Baseline", energyPercent: 100 },
            { name: "Long-radius bends", energyPercent: 90 },
            { name: "VFD control", energyPercent: 75 },
            { name: "VFD + AI optimization", energyPercent: 65 },
            { name: "Dense-phase conversion", energyPercent: 50 },
            { name: "Dense-phase + VFD + AI", energyPercent: 40 }
        ];

        let chart = null;

        // Get color based on energy percentage
        function getColor(percent) {
            // Red (100%) to Green (40%)
            if (percent >= 100) return '#e74c3c';
            if (percent >= 85) return '#e67e22';
            if (percent >= 70) return '#f39c12';
            if (percent >= 55) return '#f1c40f';
            if (percent >= 40) return '#27ae60';
            return '#27ae60';
        }

        // Calculate baseline energy (kW) based on throughput
        function calculateBaselineKW(throughput) {
            // Rough estimate: 0.45 kW per ton/hr
            return (throughput * 0.45).toFixed(2);
        }

        // Update chart and table
        function updateData() {
            const costPerKWh = parseFloat(document.getElementById('costSlider').value);
            const throughput = parseFloat(document.getElementById('throughputSlider').value);
            const operatingHours = parseFloat(document.getElementById('hoursSlider').value);

            // Update display values
            document.getElementById('costValue').textContent = costPerKWh.toFixed(2);
            document.getElementById('throughputValue').textContent = Math.round(throughput);
            document.getElementById('hoursValue').textContent = Math.round(operatingHours);
            document.getElementById('throughputDisplay').textContent = Math.round(throughput);

            // Calculate baseline kW
            const baselineKW = parseFloat(calculateBaselineKW(throughput));
            document.getElementById('baselineKW').textContent = baselineKW.toFixed(2);

            // Calculate annual values for each scenario
            const results = scenarios.map((scenario, idx) => {
                const energyKW = baselineKW * (scenario.energyPercent / 100);
                const annualKWh = energyKW * operatingHours;
                const annualCost = annualKWh * costPerKWh;
                const baselineAnnualKWh = baselineKW * operatingHours;
                const baselineAnnualCost = baselineAnnualKWh * costPerKWh;
                const annualSavings = baselineAnnualCost - annualCost;

                return {
                    ...scenario,
                    annualKWh,
                    annualCost,
                    annualSavings,
                    index: idx
                };
            });

            // Update chart
            updateChart(results);

            // Update table
            updateTable(results);
        }

        function updateChart(results) {
            const ctx = document.getElementById('energyChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: results.map(r => r.name),
                    datasets: [{
                        label: 'Energy Consumption (% of Baseline)',
                        data: results.map(r => r.energyPercent),
                        backgroundColor: results.map(r => getColor(r.energyPercent)),
                        borderColor: results.map(r => getColor(r.energyPercent)),
                        borderWidth: 2,
                        borderRadius: 8,
                        hoverBackgroundColor: results.map(r => {
                            const c = getColor(r.energyPercent);
                            return c; // Keep same color on hover
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'x',
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 13, weight: '600' },
                                color: '#2c3e50',
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 13, weight: '600' },
                            bodyFont: { size: 12 },
                            borderColor: '#fff',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(0) + '% of Baseline';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 120,
                            ticks: {
                                font: { size: 12 },
                                color: '#7f8c8d',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(200, 200, 200, 0.1)',
                                drawBorder: false
                            },
                            title: {
                                display: true,
                                text: 'Energy Consumption (% of Baseline)',
                                font: { size: 13, weight: '600' },
                                color: '#2c3e50'
                            }
                        },
                        x: {
                            ticks: {
                                font: { size: 12 },
                                color: '#7f8c8d'
                            },
                            grid: {
                                display: false,
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }

        function updateTable(results) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Find best ROI (highest annual savings)
            const bestROIIndex = results.reduce((maxIdx, current, idx) =>
                results[maxIdx].annualSavings > current.annualSavings ? maxIdx : idx, 0);

            results.forEach((result, idx) => {
                const row = document.createElement('tr');
                if (idx === bestROIIndex && result.annualSavings > 0) {
                    row.classList.add('best-roi');
                }

                row.innerHTML = `
                    <td class="scenario">${result.name}</td>
                    <td>${result.energyPercent}%</td>
                    <td>${result.annualKWh.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td>$${result.annualCost.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td class="savings">
                        $${result.annualSavings.toLocaleString('en-US', {maximumFractionDigits: 0})}
                        ${idx === bestROIIndex && result.annualSavings > 0 ? '<span class="roi-badge">Best ROI</span>' : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Event listeners for sliders
        document.getElementById('costSlider').addEventListener('input', updateData);
        document.getElementById('throughputSlider').addEventListener('input', updateData);
        document.getElementById('hoursSlider').addEventListener('input', updateData);

        // Window resize handler
        window.addEventListener('resize', () => {
            if (chart) {
                chart.resize();
            }
        });

        // Initial update
        updateData();
    </script>
</body>
</html>
